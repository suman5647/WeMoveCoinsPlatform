(function(){"use strict";function n(n,t,i,r,u,f,e){function v(){$("#bitcoinAddressHelp").popover({content:function(){return $("#bitcoinAddressHelpContent").html()},html:!0,template:k,trigger:"focus"});$("#phoneNumberHelp").popover({content:function(){return $("#phoneNumberHelpContent").html()},html:!0,trigger:"focus"});$("#phoneNumberHelp").on("shown.bs.popover",function(){var n=$(this).data("bs.popover").$tip[0].id;$("#"+n).addClass("phone-help");$(".phone-help").find(".arrow").attr("style","top:60%")})}function l(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString());document.cookie=n+"="+t+u+"; path=/"}function h(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return null}function a(n){return h(n)!=null}function c(n){var u,i,f,e;o.paymentMethodFee=$.global.format(o.cardFee,"n2",o.model.cultureCode);o.paymentMethodCommision=o.model.type==2?o.sellPaymentMethod.commission:o.paymentMethod.commission;o.fixedFee=0;u=o.model.type==2?1-o.model.sellPaymentMethodDetail.spread/100:1+o.model.paymentMethodDetail.spread/100;(o.model.fxMarkUp===undefined||o.model.fxMarkUp==null)&&(o.model.fxMarkUp=0);var s=o.model.type==2?1-o.model.fxMarkUp/100:1+o.model.fxMarkUp/100,r=o.cardFee,t=0;o.model.type==2&&o.model.sellPaymentMethodDetail.methods.forEach(function(n){o.sellPaymentMethod.name==n.name&&(o.paymentMethodFee=$.global.format(n.fee,"n2",o.model.cultureCode),r=o.cardFee/100,t=n.commission/100,o.paymentMethodCommision=n.commission,o.sellPaymentMethod.name=="Bank"&&(o.fixedFee=n.fixedFee))});n==""||n<=0?o.model.type==1?(o.youPayBuyAmount="0 "+o.model.forCurrency,o.fee="0 "+o.model.forCurrency,o.commision="0 "+o.model.forCurrency,o.youReceiveBitcoins="0 BTC"):(o.youPayBuyAmount="0 BTC",o.fee="0 BTC",o.commision="0 BTC",o.youReceiveBitcoins="0 "+o.model.forCurrency):(o.model.type==1?(r=o.cardFee/100,t=o.paymentMethod.commission/100,o.fee=o.paymentMethod.name=="CreditCard"?$.global.format(n*r+o.model.minersFee*o.model.euroBtcRate*o.model.euroCurrencyRate,"n2",o.model.cultureCode)+" "+o.model.forCurrency:$.global.format(n*r,"n2",o.model.cultureCode)+" "+o.model.forCurrency):(o.model.forDigitalCurrency!="BTC"&&(n=n/o.model.btc2SellCurrencyNumeric,o.discount=n*t*(o.discountPercentage/100)),o.sellPaymentMethod.name=="CreditCard"&&(o.fee=$.global.format(n*r*o.model.euroBtcRate*o.model.euroCurrencyRate,"n2",o.model.cultureCode)+" "+o.model.forCurrency)),i=parseFloat(o.model.btc2LocalCurrencyNumeric)*u*s,o.minersFee=$.global.format(o.model.minersFee*i,"n2",o.model.cultureCode)+" "+o.model.forCurrency,o.discountPercentage===undefined||o.discountPercentage==0?(o.commision=$.global.format(n*t,"n2",o.model.cultureCode)+" "+o.model.forCurrency,o.discount=0,o.discountPercentage=0):(o.discount=n*t*(o.discountPercentage/100),o.commision=$.global.format(n*t-o.discount,"n2",o.model.cultureCode)+" "+o.model.forCurrency),o.model.type==1?(f=o.paymentMethod.name=="CreditCard"?(n-n*r-n*t-o.model.minersFee*i)/i:(n-n*t-o.model.minersFee*i)/i,o.youPayBuyAmount=$.global.format(n*1,"n2",o.model.cultureCode)+" "+o.model.forCurrency,o.youReceiveBitcoins=$.global.format(f,"n8",o.model.cultureCode)+" BTC"):(e=o.sellPaymentMethod.name=="CreditCard"?n-n*r-n*t:n-n*t,o.fixedFeeLocalCurrency=$.global.format(o.fixedFee*o.model.euroCurrencyRate,"n2",o.model.cultureCode)+" "+o.model.forCurrency,o.youPayBuyAmount=$.global.format(n*1,"n8",o.model.cultureCode)+" BTC",o.commision=o.discountPercentage==0?$.global.format(n*t*i,"n2",o.model.cultureCode)+" "+o.model.forCurrency:$.global.format((n*t-o.discount)*i,"n2",o.model.cultureCode)+" "+o.model.forCurrency,o.youReceiveBitcoins=$.global.format(e*i-o.fixedFee*o.model.euroCurrencyRate,"n2",o.model.cultureCode)+" "+o.model.forCurrency))}function d(n){var r=$.trim(n).split(" "),t,i;return r.length<2?!1:(t=$.trim(n).split(" ")[0],i=$.trim(n).split(" ")[1],t.length>1&&i.length>1?!0:!1)}function g(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)}function s(){o.placeOrderButtonDisabled=o.validBuyAmount&&(o.model.type==2?!0:o.validBitcoinAddress)&&o.validFullName&&o.validEmail&&o.validMobile&&o.validTermsAndConditions&&o.validReCaptcha?!1:!0}function y(){$("#showIBANPageNullError").css("display","none");o.validIBAN||o.validReg&&o.validAccount?(o.IBANButtonDisabled=!1,$("#showIBANPageNullError").css("display","none")):(o.IBANButtonDisabled=!0,$("#showIBANPageNullError").css("display","inherit"))}function p(){o.model.type==2&&o.confirmBitcoinAddress();o.verifyBitcoinViewEnabled=!1;o.verifyPhoneNumberViewEnabled=!0;$("#address-box").addClass("disable");$("#address-box").hide("slow");$("#confrm-box").removeClass("disable");$("#txt-verifypasscode").focus()}function nt(){o.verifyIdentityViewEnabled=!0;o.verifyPhoneNumberViewEnabled=!1;$("#confrm-box").addClass("disable");$("#id-box").removeClass("disable");$("#confrm-box").hide("slow")}var w=navigator.language.substr(0,2),k='<div class="popover bitcoin-address-help" role="popover"><div class="arrow"><\/div><h3 class="popover-title"><\/h3><div class="popover-content bitcoin-address-help-popover-content"><\/div><\/div>',o=this,b;o.model=f;(o.model.operationalStatus=="opensellclosebuy"||o.model.operationalStatus=="closesellopenbuy")&&($("#cbBuySellSlider").attr("disabled","disabled"),$("#spBuySellSlider").attr("style","background-color: lightgray"));o.createToast=function(n,t){var i={content:n,className:t+" ngtoast-message"};e.create(i)};o.paymentMethods=o.model.paymentMethodDetail.methods;o.paymentMethod=o.model.paymentMethod==null||o.model.paymentMethod==""?o.model.paymentMethodDetail.methods[0]:o.model.paymentMethod;o.sellPaymentMethods=o.model.sellPaymentMethodDetail.methods;o.sellPaymentMethod=o.model.sellPaymentMethod==null||o.model.sellPaymentMethod==""?o.model.sellPaymentMethodDetail.methods[0]:o.model.sellPaymentMethod;o.placeOrderButtonDisabled=!0;o.IBANButtonDisabled=!0;o.validBuyAmount=!1;o.validBitcoinAddress=o.model.type==2?!0:!1;o.validFullName=!1;o.validEmail=!1;o.validMobile=!1;o.validReCaptcha=o.model.reCaptchaStatus!="Enabled";o.minersFee=o.model.minersFee;o.cardFee=o.model.cardFee;o.validTermsAndConditions=!1;o.recieveNewsletters=!0;o.orderInfoViewEnabled=!0;o.verifyBitcoinViewEnabled=!1;o.verifyPhoneNumberViewEnabled=!1;o.verifyIdentityViewEnabled=!1;o.ibanViewEnabled=!1;n.enterkeyPressed=function(){o.orderInfoViewEnabled&&(n.validateBuyAmount(o.model.buyAmount),n.validateFullName(o.model.fullName),n.validateEmail(o.model.eMail),n.validateMobile(o.model.mobile),o.model.couponCode!=""&&n.validateCoupon(o.model.couponCode),o.model.type==1&&n.validateBitcoinAddress(o.model.bitcoinAddress,!0,!0));o.verifyBitcoinViewEnabled&&o.confirmBitcoinAddress();o.verifyPhoneNumberViewEnabled&&o.verifyPhoneNumber();o.verifyIdentityViewEnabled&&($("#btn-submit").prop("disabled")||o.submitIdentityVerification(!0));o.model.ViewName=="IBAN"&&n.validateIBAN(o.IBAN,o.Reg,o.Account)};n.validateIBAN=function(n){o.validIBAN=!1;o.validIBAN=n==null||n==""?!1:!0;y()};n.validateReg=function(n){o.validReg=!1;o.validReg=n==null||n==""?!1:!0;y()};n.validateAccount=function(n){o.validAccount=!1;o.validAccount=n==null||n==""?!1:!0;y()};n.validateBuyAmount=function(n){o.validBuyAmount=!1;$("#showBuyAmountNullError").css("display","none");$("#showBuyAmountInvalidError").css("display","none");$("#showBuyAmountInvalidErrorBuy").css("display","none");$("#showBuyAmountInvalidErrorSell").css("display","none");n==null||n==""?($("#buyAmountDetail").css("opacity","0"),$("#buyAmountDetail").css("display","none"),$("#showBuyAmountNullError").css("display","inherit")):($("#buyAmountDetail").css("opacity","1"),$("#buyAmountDetail").css("display","inherit"),$("#showBuyAmountNullError").css("display","none"),o.model.type==1?n<o.model.orderSizeBoundary.min||n>o.model.orderSizeBoundary.max?($("#showBuyAmountInvalidError").css("display","inherit"),$("#showBuyAmountInvalidErrorBuy").css("display","inherit")):($("#showBuyAmountInvalidError").css("display","none"),$("#showBuyAmountInvalidErrorBuy").css("display","none"),o.validBuyAmount=!0):n<o.model.orderSizeBoundary.min||n>o.model.orderSizeBoundary.max?(o.model.forDigitalCurrency=="BTC"?(o.model.orderSizeBoundary.min=parseFloat(o.model.orderSizeBoundary.min.toFixed(8)),o.model.orderSizeBoundary.max=parseFloat(o.model.orderSizeBoundary.max.toFixed(8))):(o.model.orderSizeBoundary.min=Math.ceil(o.model.orderSizeBoundary.min),o.model.orderSizeBoundary.max=Math.floor(o.model.orderSizeBoundary.max)),$("#showBuyAmountInvalidError").css("display","inherit"),$("#showBuyAmountInvalidErrorSell").css("display","inherit")):($("#showBuyAmountInvalidError").css("display","none"),$("#showBuyAmountInvalidErrorSell").css("display","none"),o.validBuyAmount=!0));c(n);s()};n.validateBitcoinAddress=function(n,t,i){o.validBitcoinAddress=!1;$("#showBitcoinAddressNullError").css("display","none");$("#showBitcoinAddressInvalidError").css("display","none");n==null||n==""?$("#showBitcoinAddressNullError").css("display","inherit"):$.get("/ValidateBitcoinAddress?bitcoinAddress="+n,function(n){n=="Valid"?($("#showBitcoinAddressInvalidError").css("display","none"),o.validBitcoinAddress=!0):$("#showBitcoinAddressInvalidError").css("display","inherit");t&&s();i&&(o.placeOrderButtonDisabled||o.submitOrder(!0))});s()};n.validateFullName=function(n){o.validFullName=!1;$("#showFullNameNullError").css("display","none");$("#showFullNameInvalidError").css("display","none");$("#showFullNameTooLongError").css("display","none");n==null||n==""?$("#showFullNameNullError").css("display","inherit"):n.length>50?$("#showFullNameTooLongError").css("display","inherit"):d(n)?($("#showFullNameInvalidError").css("display","none"),o.validFullName=!0):$("#showFullNameInvalidError").css("display","inherit");s()};n.validateEmail=function(n){o.validEmail=!1;$("#showEmailAddressNullError").css("display","none");$("#showEmailAddressInvalidError").css("display","none");$("#showEmailAddressTooLongError").css("display","none");n==null||n==""?$("#showEmailAddressNullError").css("display","inherit"):n.length>50?$("#showEmailAddressTooLongError").css("display","inherit"):g(n)?($("#showEmailAddressInvalidError").css("display","none"),o.validEmail=!0):$("#showEmailAddressInvalidError").css("display","inherit");s()};n.validateMobile=function(n){$("#showMobileNumberNullError").css("display","none");$("#showMobileNumberInvalidError").css("display","none");n==null||n==""?(o.validMobile=!1,$("#showMobileNumberNullError").css("display","inherit")):Inputmask.isValid(n,{mask:o.model.mobileNumberFormat})?(o.validMobile=!0,$("#showMobileNumberNullError").css("display","none")):(o.validMobile=!1,$("#showMobileNumberInvalidError").css("display","inherit"));s()};n.validateCoupon=function(n){n.length>0?($("#coupontext").text("Validating.."),document.getElementById("couponicon").className="fa fa-refresh fa-spin",i.post("/ValidateCouponCode",{couponCode:n}).success(function(n){o.discountPercentage=n.discount;o.validCouponCode=n.validity;o.couponErrorMessage=n.errorMessage;!0==o.validCouponCode?(o.createToast("Coupon code is applied successfully.","info"),$("#coupontext").text(" Valid "),$("#couponbtn").css("background-color","#449d44"),document.getElementById("couponicon").className="fa fa-check"):(o.couponErrorMessage=="InvalidOrExpired"&&o.createToast("Coupon code is Invalid.","danger"),o.couponErrorMessage=="MaxTxnCountReached"&&o.createToast("Usage limit exceeded for this coupon.","danger"),$("#coupontext").text(" Invalid "),$("#couponbtn").css("background-color","#d9534f"),document.getElementById("couponicon").className="fa fa-times");o.model.buyAmount==""||o.buyAmount<=0||c(o.model.buyAmount);s()}).error(function(n){dataLayer.push({ErrorMessage:n.errorMessage,event:"error"})})):(document.getElementById("couponicon").className="",$("#coupontext").text(" Validate "),$("#couponbtn").css("background-color","#449d44"),o.discountPercentage=0,o.model.buyAmount==""||o.buyAmount<=0||c(o.model.buyAmount))};$(document).ready(function(){v()});n.validateTermsAndConditions=function(n){o.validTermsAndConditions=n==null||n==!0?!0:!1;s()};o.acceptTAndC=function(){o.acceptedTAndC=!0;o.validTermsAndConditions=!0;s()};o.CheckIfCaptcha=function(){o.validReCaptcha=!0;s()};o.buySell=o.model.type==2;o.buySellSelect=function(){o.model.type=o.buySell===!0?2:1;o.currencyChanged();o.model.buyAmount="";$("#showBuyAmountInvalidErrorBuy").css("display","none");$("#showBuyAmountInvalidErrorSell").css("display","none");$("#buyAmountDetail").css("display","none");v();c(o.model.buyAmount)};a("BitcoinAddress")&&(o.model.bitcoinAddress==null||o.model.bitcoinAddress=="")&&h("BitcoinAddress")!=null&&(o.model.bitcoinAddress=h("BitcoinAddress"));a("FullName")&&(o.model.fullName==null||o.model.fullName=="")&&(o.model.fullName=h("FullName"));a("EMail")&&(o.model.eMail==null||o.model.eMail=="")&&(o.model.eMail=h("EMail"));a("MobileNumber")&&(o.model.mobile==null||o.model.mobile=="")&&(b=o.model.mobileNumberFormat.replace(/9/g,"#"),o.model.mobile=h("MobileNumber").replace(/ /g,"").mask(b));o.model.buyAmount==null||o.model.buyAmount==""||n.validateBuyAmount(o.model.buyAmount);o.model.bitcoinAddress==null||o.model.bitcoinAddress==""||n.validateBitcoinAddress(o.model.bitcoinAddress,!1,!1);o.model.fullName==null||o.model.fullName==""||n.validateFullName(o.model.fullName);o.model.eMail==null||o.model.eMail==""||n.validateEmail(o.model.eMail);o.model.mobile==null||o.model.mobile==""||n.validateMobile(o.model.mobile);o.currencyChanged=function(){var t=o.model.type==1?o.paymentMethod.name:o.sellPaymentMethod.name;$.get("/currencyChanged?currency="+o.model.forCurrency+"&sellCurrency="+o.model.forDigitalCurrency+"&paymentMethod="+t+"&type="+o.model.type,function(t){o.model.btc2LocalCurrency=t.latestBTCRate.data.formatedRate;o.model.btc2LocalCurrencyNumeric=t.latestBTCRate.data.rate;o.model.btc2SellCurrencyNumeric=t.latestSellRate.data.rate;o.model.btc2LocalBuyTicker=t.buyTicker.data.formatedRate;o.model.btc2LocalSellTicker=t.sellTicker.data.formatedRate;o.model.btc2LocalCurrencyBuyNumeric=t.buyTicker.rate;o.model.btc2LocalCurrencySellNumeric=t.sellTicker.rate;o.model.forDigitalCurrency=="BTC"?(o.model.orderSizeBoundary.min=parseFloat(t.orderSizeBoundary.min.toFixed(8)),o.model.orderSizeBoundary.max=parseFloat(t.orderSizeBoundary.max.toFixed(8))):(o.model.orderSizeBoundary.min=Math.ceil(t.orderSizeBoundary.min),o.model.orderSizeBoundary.max=Math.floor(t.orderSizeBoundary.max));o.model.euroCurrencyRate=t.euroCurrencyRate;o.model.euroBtcRate=t.euroBtcRate;o.model.cultureCode=t.cultureCode;o.model.fxMarkUp=t.fxMarkUp;n.validateBuyAmount(o.model.buyAmount);n.$apply()})};o.paymentMethodChanged=function(){var t=o.model.type==1?o.paymentMethod.name:o.sellPaymentMethod.name;$.get("/paymentMethodChanged?paymentMethod="+t+"&currency="+o.model.forCurrency+"&sellCurrency="+o.model.forDigitalCurrency+"&type="+o.model.type,function(t){o.model.forDigitalCurrency=="BTC"?(o.model.orderSizeBoundary.min=parseFloat(t.orderSizeBoundary.min.toFixed(8)),o.model.orderSizeBoundary.max=parseFloat(t.orderSizeBoundary.max.toFixed(8))):(o.model.orderSizeBoundary.min=Math.ceil(t.orderSizeBoundary.min),o.model.orderSizeBoundary.max=Math.floor(t.orderSizeBoundary.max));n.validateBuyAmount(o.model.buyAmount);n.$apply()})};o.KycRequirement="NONE";o.submitOrder=function(r){o.model.type==1?l("BitcoinAddress",o.model.bitcoinAddress):o.model.bitcoinAddress="";l("FullName",o.model.fullName);l("EMail",o.model.eMail);l("MobileNumber",o.model.mobile);var f=o.model.type==1?o.paymentMethod.name:o.sellPaymentMethod.name;i.post("/Verification",{product:o.model.product,buyAmount:o.model.buyAmount,purchaseCurrency:o.model.forCurrency,sellCurrency:o.model.forDigitalCurrency,paymentMethod:f,btcAddress:o.model.bitcoinAddress,fullName:o.model.fullName,email:o.model.eMail,phoneCodeId:o.model.phoneCodeId,phoneNumber:o.model.mobile,bccAddress:o.model.bccAddress,partnerId:o.model.partnerId,respondWithView:r,type:o.model.type,recieveNewsletters:o.recieveNewsletters,couponCode:o.model.couponCode,reCaptcha:o.model.recaptcha,Reg:o.model.reg,IBAN:o.model.iban,SwiftCode:o.model.swiftCode,AccountNumber:o.model.accountNumber}).success(function(i){r?(o.orderInfoViewEnabled=!1,$("#tabContent").html(u(i)(n)),o.model.type==1?o.verifyBitcoinViewEnabled=!0:p(),$("#orderInfoProgressBarItem").removeClass("active"),$("#verificationProgressBarItem").addClass("active"),$("#paymentProgressBarItem").removeClass("active"),$("#receiptProgressBarItem").removeClass("active"),t.scroll(0,0)):(o.KycRequirement=i.kycRequirement,o.model.type==1?o.confirmBitcoinAddress():p());dataLayer.push({currency:o.model.forCurrency,paymentMethod:o.paymentMethod.name,country:o.model.phoneCode,virtualPage:"/"+w+"/funnel/verification-address",event:"virtualPageview"})}).error(function(n){o.model.recaptcha="";n.errorMessage=="OrderAmountOutOfRange"?(o.createToast("Order amount is not within range.","danger"),dataLayer.push({ErrorMessage:"Order amount is not within range.",event:"error"})):n.errorMessage=="BitcoinAddressInvalid"?(o.createToast("Bitcoin address validation failed.","danger"),dataLayer.push({ErrorMessage:"Invalid bitcoin address.",event:"error"})):n.errorMessage=="FullNameEmpty"?(o.createToast("Please enter firstname and surname.","danger"),dataLayer.push({ErrorMessage:"Full name empty.",event:"error"})):n.errorMessage=="DayTransactionLimitExceeded"?(o.createToast("Number of Transactions per day has exceeded.","danger"),dataLayer.push({ErrorMessage:"Number of Transactions per day has exceeded.",event:"error"})):n.errorMessage=="PerTransactionAmountLimitExceeded"?(o.createToast("Transaction limit per order is exceeded","danger"),dataLayer.push({ErrorMessage:"Transaction limit per order is exceeded.",event:"error"})):n.errorMessage=="DayTransactionAmountLimitExceeded"?(o.createToast("Transaction limit per day is exceeded","danger"),dataLayer.push({ErrorMessage:"Transaction limit per day is exceeded.",event:"error"})):n.errorMessage=="MonthTransactionAmountLimitExceeded"?(o.createToast("Transaction limit per month has been exceeded","danger"),dataLayer.push({ErrorMessage:"Transaction limit per month has been exceeded.",event:"error"})):n.errorMessage=="FullNameTooLong"?(o.createToast("Name is too long. Please enter and email within 20 characters.","danger"),dataLayer.push({ErrorMessage:"Name is too long.",event:"error"})):n.errorMessage=="EmailEmpty"?(o.createToast("Email address cannot be empty.","danger"),dataLayer.push({ErrorMessage:"Email address is empty.",event:"error"})):n.errorMessage=="EmailInvalid"?(o.createToast("Email address is invalid.","danger"),dataLayer.push({ErrorMessage:"Email address is invalid..",event:"error"})):n.errorMessage=="EmailTooLong"?(o.createToast("Email address is too long. Please enter and email within 50 characters.","danger"),dataLayer.push({ErrorMessage:"Email address is too long.",event:"error"})):(o.createToast("Unable to process the order please contact the site administrator.","danger"),dataLayer.push({ErrorMessage:"Error in processing order.",event:"error"}))})};o.showReceipt=function(){$("#orderInfoProgressBarItem").removeClass("active");$("#verificationProgressBarItem").removeClass("active");$("#paymentProgressBarItem").removeClass("active");$("#receiptProgressBarItem").addClass("active");i.post("/Receipt",{receiptModel:null}).success(function(t){$("#tabContent").html(u(t)(n))})};o.SaveIBAN=function(){$("#QRLoading").show();i.post("/SaveIBAN",{SwiftCode:o.SwiftCode,IBAN:o.IBAN,Reg:o.Reg,Account:o.Account}).success(function(){n.CryptoCurrencyPaymentInfo()}).error(function(){})};n.initPaymentFrame=function(){$("#paymentFrameLoading").hide()};n.CryptoCurrencyPaymentInfo=function(){i.post("/CryptoCurrencyPaymentInfo").success(function(t){$("#tabContent").html(u(t)(n));o.model.ViewName=="QRPage"&&(o.model.CryptoCurrencyPaymentInfoPageLoaded=!0)}).error(function(n){console.log(n)})};o.backToOrder=function(t){$.get("/OrderInfo",function(i){$("#tabContent").html(u(i)(n));t&&(o.model.skipOrderForm=!1);o.orderInfoViewEnabled=!0;o.verifyBitcoinViewEnabled=!1;o.validReCaptcha=o.model.reCaptchaStatus!="Enabled";$("#orderInfoProgressBarItem").addClass("active");$("#verificationProgressBarItem").removeClass("active");$("#paymentProgressBarItem").removeClass("active");$("#receiptProgressBarItem").removeClass("active");v()})};o.confirmBitcoinAddress=function(){i.post("/SendVerificationCode",{}).success(function(){dataLayer.push({virtualPage:"/"+w+"/funnel/verification-number",event:"virtualPageview"});o.model.type==1&&p()}).error(function(n,t){t===429&&o.createToast("Multiple requests for verification code is denied. If you don't the verification code, please contact the system administrator.","warning");dataLayer.push({ErrorMessage:"Error in sending verification code.",event:"error"})})};o.verifyPhoneNumber=function(){i.post("/VerifyPhoneNumber",{verificationCode:o.verificationCode}).success(function(n){n.kycRequirement=="NONE"?o.submitIdentityVerification(!1):(nt(),o.createToast("Phone number is verified successfully.","info"));o.verificationCode=""}).error(function(){o.createToast("Verification code is incorrect.","danger");dataLayer.push({ErrorMessage:"Verification code is incorrect.",event:"error"})})};o.backtoBitcoinAddressConfirmation=function(){i.post("/BitcoinAddressConfirmationView",{}).success(function(){o.verifyBitcoinViewEnabled=!0;o.verifyPhoneNumberViewEnabled=!1;$("#address-box").show("slow");$("#address-box").removeClass("disable");$("#confrm-box").addClass("disable")}).error(function(){dataLayer.push({ErrorMessage:"Error in bitcoin address confirmation view.",event:"error"})})};o.resendVerificationCode=function(){i.post("/SendVerificationCode",{}).success(function(){o.verificationCode="";o.createToast("Verification code sent.","info")}).error(function(n,t){t===429&&o.createToast("Multiple requests for verification code is denied. If you don't the verification code, please contact the system administrator.","warning");dataLayer.push({ErrorMessage:"Error in sending verification code.",event:"error"})})};o.backtoPhoneNumberVerification=function(){o.verificationCode="";o.verifyPhoneNumberViewEnabled=!0;o.verifyIdentityViewEnabled=!1;$("#confrm-box").show("slow");$("#address-box").addClass("disable");$("#confrm-box").removeClass("disable");$("#id-box").addClass("disable")};o.submitIdentityVerification=function(t){i.post("/SubmitIdentityVerification",{withKYC:t}).success(function(t){$("#tabContent").html(u(t)(n));$("#orderInfoProgressBarItem").removeClass("active");$("#verificationProgressBarItem").removeClass("active");var i=o.model.type==1?o.paymentMethod.name:o.sellPaymentMethod.name;i=="CreditCard"?$("#paymentProgressBarItem").addClass("active"):$("#paymentInstructionsProgressBarItem").addClass("active");$("#receiptProgressBarItem").removeClass("active")}).error(function(n){dataLayer.push({ErrorMessage:n.errorMessage,event:"error"})})};o.phoneCodeChanged=function(){o.model.phoneCode=o.model.phoneCodes.filter(function(n){return n.item1===o.model.phoneCodeId})[0].item3;$.get("/getPhoneNumberStyle?phonecode="+o.model.phoneCode,function(t){o.model.mobile="";o.model.mobileNumberFormat=t.phoneNumberStyle;o.cardFee=t.cardFee;$("#txtMobileNumber").inputmask({mask:o.model.mobileNumberFormat,greedy:!1});c(o.model.buyAmount);n.$apply()})};o.getBTC2LocalCurrency=function(){$.get("/LatestBTCRate2?currency="+o.model.forCurrency,function(n){o.model.btc2LocalCurrency=n.formatedRate;o.model.btc2LocalCurrencyNumeric=n.rate})};o.getBuySellBTC2LocalCurrency=function(){$.get("/LatestBTCBuySellRate2?currency="+o.model.forCurrency+"&type=1",function(n){o.model.btc2LocalBuyTicker=n.formatedRate;o.model.btc2LocalCurrencyBuyNumeric=n.rate});$.get("/LatestBTCBuySellRate2?currency="+o.model.forCurrency+"&type=2",function(n){o.model.btc2LocalSellTicker=n.formatedRate;o.model.btc2LocalCurrencySellNumeric=n.rate})};o.checkBTCTransaction=function(){o.model.CryptoCurrencyPaymentInfoPageLoaded&&i.post("/CheckIfPaid").success(function(t){t=="True"&&(o.model.CryptoCurrencyPaymentInfoPageLoaded=!1,n.CryptoCurrencyPaymentInfo())})};o.interval=function(){o.checkBTCTransaction();o.getBTC2LocalCurrency();o.getBuySellBTC2LocalCurrency()};r(o.interval,1e4)}window.app.controller("vm.paymentController",n).directive("keyPressed",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.myEnter)}),n.enterkeyPressed(),t.preventDefault())})}}).directive("opacity",function(n){return{link:function(t,i,r){var u=r.opacity;n(function(){i[0].style.opacity=u},500)}}}).directive("buyAmount",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateBuyAmount(t),t})}}}).directive("bitcoinAddress",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateBitcoinAddress(t,!0,!1),t})}}}).directive("fullName",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateFullName(t),t})}}}).directive("couponCode",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateCoupon(t),t})}}}).directive("iban",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateIBAN(t),t})}}}).directive("reg",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateReg(t),t})}}}).directive("account",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateAccount(t),t})}}}).directive("email",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateEmail(t),t})}}}).directive("mobile",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateMobile(t),t})}}}).directive("inputMask",function(){return{restrict:"A",link:function(n,t,i){$(t).inputmask(n.$eval(i.inputMask));$(t).on("change",function(){n.$eval(i.ngModel+"='"+t.val()+"'")})}}}).directive("tc",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(t){return n.validateTermsAndConditions(t),t})}}}).directive("droppableArea",function(){return{scope:{drop:"&"},link:function(n,t){var i=t[0],r=i.id=="dragdrophandlerfilePhotoID"?"PhotoID":"ProofOfRecidency"}}}).run(function(){$("#progressbarContainer").show()});n.$inject=["$scope","$window","$http","$interval","$compile","model","ngToast","vcRecaptchaService"];String.prototype.mask=function(n){for(var n,f=(n=n.split("")).length,r=this.split(""),u=0,t="",i=-1;++i<f;)if(n[i]!="#"){if(n[i]=="\\"&&(t+=n[++i]))continue;t+=n[i];i+1==f&&(r[u-1]+=t,t="")}else{if(!r[u]&&!(t=""))break;(r[u]=t+r[u++])&&(t="")}return r.join("")+t}})();