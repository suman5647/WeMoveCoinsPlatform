function sendFileToServer(n,t,i){var r=$.ajax({xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){var t=0,r=n.loaded||n.position,u=n.total;n.lengthComputable&&(t=Math.ceil(r/u*100));i.setProgress(t)},!1),n},url:"/KYCFileUpload",type:"POST",contentType:!1,processData:!1,cache:!1,data:n,success:function(n){$("#btn-submit").prop("disabled",!1);i.setProgress(100);$.each(n,function(n,i){t==="PhotoID"?$("#photoIDUploadedFiles").append("<span id="+i.id+"><img src='images/close.png' alt='' onclick='removeFile("+i.id+");'/> "+i.originalFilename+"<br><\/span>"):t==="ProofOfRecidency"&&$("#proofOfRecidencyUploadedFiles").append("<span id="+i.id+"><img src='images/close.png' alt='' onclick='removeFile("+i.id+");'/> "+i.originalFilename+"<br><\/span>")})},error:function(){}});i.setAbort(r)}function createStatusbar(){rowCount++;var n="odd";rowCount%2==0&&(n="even");this.statusbar=$("<div class='statusbar "+n+"'><\/div>");this.filename=$("<div class='filename'><\/div>").appendTo(this.statusbar);this.size=$("<div class='filesize'><\/div>").appendTo(this.statusbar);this.progressBar=$("<div class='progressBar'><div><\/div><\/div>").appendTo(this.statusbar);this.abort=$("<div class='abort'>Abort<\/div>").appendTo(this.statusbar);this.setFileNameSize=function(n,t){var i="",r=t/1024,u;parseInt(r)>1024?(u=r/1024,i=u.toFixed(2)+" MB"):i=r.toFixed(2)+" KB";this.filename.html(n);this.size.html(i)};this.setProgress=function(n){var t=n*this.progressBar.width()/100;this.progressBar.find("div").animate({width:t},10).html(n+"% ");parseInt(n)>=100&&this.abort.hide()};this.setAbort=function(n){var t=this.statusbar;this.abort.click(function(){n.abort();t.hide()})}}function handleMultipleFileUpload(n,t,i){for(var f,u,e,r=0;r<n.length;r++){f=n[r].name.split(".").pop();switch(f.toUpperCase()){case"PNG":case"JPG":case"JPEG":break;default:alert("File types with ."+f+" extensions is not allowed.");return}u=new FormData;u.append("kycFile"+r,n[r]);u.append("fileType",i);e=new createStatusbar(t);e.setFileNameSize(n[r].name,n[r].size);sendFileToServer(u,i,e)}}function handleFileUpload(n,t,i){var r=new FormData,u;r.append("kycFile",n);r.append("fileType",i);u=new createStatusbar(t);u.setFileNameSize(n.name,n.size);sendFileToServer(r,i,u)}function addDragDropHandlers(n,t){n.on("dragenter",function(n){n.stopPropagation();n.preventDefault();$(this).css("border","2px solid #92AAB0")});n.on("dragleave",function(n){n.stopPropagation();n.preventDefault();$(this).css("border","2px dashed #92AAB0")});n.on("dragover",function(n){n.stopPropagation();n.preventDefault()});n.on("drop",function(i){$(this).css("border","2px dashed #92AAB0");i.preventDefault();handleMultipleFileUpload(i.originalEvent.dataTransfer.files,n,t)})}function removeFile(n){var t=$.ajax({url:"/DeleteKYCFile",type:"POST",data:{id:n},success:function(){$("#"+n).remove()},error:function(){}})}function initkycFileUpload(){addDragDropHandlers($("#dragdrophandlerfileProofOfRecidency"),"ProofOfRecidency");addDragDropHandlers($("#dragdrophandlerfilePhotoID"),"PhotoID");$(document).on("dragenter",function(n){n.stopPropagation();n.preventDefault()});$(document).on("dragover",function(n){n.stopPropagation();n.preventDefault();$("#dragdrophandlerfileProofOfRecidency").css("border","2px dashed #92AAB0");$("#dragdrophandlerfilePhotoID").css("border","2px dashed #92AAB0")});$(document).on("drop",function(n){n.stopPropagation();n.preventDefault()})}function initPayLikePaymentFrame(n,t,i,r,u,f,e,o,s,h){$(".tab-pages").height(100);Paylike(n).popup({currency:r,amount:u,custom:{OrderNumber:t},descriptor:f+":"+i,overwrite_usage:f+":"+i},function(n,t){var i,u;if(n)return console.warn(n);i=new FormData;i.append("tid",t.transaction.id);$("#paymentFrameLoading").show();u=$.ajax({url:"/PayLikeAccept",type:"POST",contentType:!1,processData:!1,cache:!1,data:i,success:function(n){updateDataLayerTransaction(e,o,r,s,h);$("#paymentFrameLoading").hide();$("#tabContent").html(n);$("#orderInfoProgressBarItem").removeClass("active");$("#verificationProgressBarItem").removeClass("active");$("#paymentProgressBarItem").removeClass("active");$("#receiptProgressBarItem").addClass("active")},error:function(){}})})}function updateDataLayerTransaction(n,t,i,r){dataLayer.push({virtualPage:"/"+userLang+"/funnel/receipt",event:"virtualPageview"});dataLayer.push({transactionId:n,transactionTotal:t,transactionTax:"0",transactionShipping:r,transactionProducts:[{name:"SellBitcoins",price:t,currency:i,quantity:"1"}],event:"transactionComplete"})}var rowCount=0;